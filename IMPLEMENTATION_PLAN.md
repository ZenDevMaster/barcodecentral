# Implementation Plan - Turnkey Deployment System

## Overview

Create a zero-friction deployment system where users can:
1. Clone repository
2. Run interactive setup script
3. Review/edit generated docker-compose.yml
4. Run `docker compose up -d`
5. System auto-configures and starts

## Files to Create/Modify

### 1. Interactive Setup Script
**File**: `setup.sh`
- Interactive wizard for configuration
- Asks about Traefik (yes/no)
- Asks about Headscale (yes/no)
- Asks about domain names
- Asks about reverse proxy choice (Traefik/Nginx/None)
- Generates `.env` file
- Generates appropriate `docker-compose.yml`
- Creates required directories
- Displays next steps (DNS, firewall, etc.)

### 2. Unified Docker Compose
**File**: `docker-compose.yml` (generated by setup.sh)
- Single file with conditional services
- Traefik section (enabled/disabled via profiles)
- Headscale section (enabled/disabled via profiles)
- Application always enabled
- Uses environment variables for configuration

### 3. Environment Template
**File**: `.env.example`
- Comprehensive template with all options
- Comments explaining each variable
- Sections for: App, Traefik, Headscale
- Setup script copies and populates this

### 4. Raspberry Pi Quick Setup
**File**: `raspberry-pi-setup.sh`
- Single script to run on Pi
- Prompts for: location name, Headscale URL, auth key, subnet
- Installs Tailscale
- Connects to Headscale
- Configures subnet routing
- Sets up monitoring

### 5. Post-Setup Instructions
**File**: `QUICKSTART.md` (update existing)
- DNS configuration steps
- Firewall port opening
- Headscale route enabling
- First login instructions
- Troubleshooting quick reference

### 6. Helper Scripts
**File**: `scripts/configure-firewall.sh`
- Detects OS (Ubuntu/Debian/CentOS/etc.)
- Opens required ports based on configuration
- Shows commands for manual execution

**File**: `scripts/generate-authkey.sh`
- Generates Headscale pre-auth key
- Displays key for Raspberry Pi setup

**File**: `scripts/enable-routes.sh`
- Lists pending routes
- Enables routes interactively

## User Flow

### VPS Setup
```bash
# 1. Clone repository
git clone https://github.com/ZenDevMaster/barcodecentral.git
cd barcodecentral

# 2. Run setup wizard
./setup.sh

# 3. Review generated files
nano docker-compose.yml  # Optional
nano .env                # Optional

# 4. Deploy
docker compose up -d

# 5. Configure firewall (if needed)
./scripts/configure-firewall.sh

# 6. Generate auth key for Raspberry Pis (if using Headscale)
./scripts/generate-authkey.sh
```

### Raspberry Pi Setup
```bash
# One-liner setup
curl -sSL https://raw.githubusercontent.com/ZenDevMaster/barcodecentral/main/raspberry-pi-setup.sh | bash
```

## Setup Script Flow

```
Welcome to Barcode Central Setup!
==================================

This wizard will configure your deployment.

[1/8] Deployment Type
  → Basic (HTTP, local printers only)
  → Production (HTTPS with Traefik)
  → Distributed (HTTPS + Headscale mesh)
  
[2/8] Domain Configuration (if Production/Distributed)
  → Enter domain: print.example.com
  → Enter email for SSL: admin@example.com
  
[3/8] Headscale Configuration (if Distributed)
  → Enter Headscale domain: headscale.example.com
  
[4/8] Application Credentials
  → Admin username: [admin]
  → Admin password: [generate secure]
  → Secret key: [auto-generate]
  
[5/8] Network Configuration
  → HTTP port: [5000]
  → HTTPS port: [443] (if Traefik)
  → Headscale port: [8080] (if Headscale)
  
[6/8] Review Configuration
  [Display all settings]
  → Confirm? (y/n)
  
[7/8] Generating Files
  ✓ Created .env
  ✓ Created docker-compose.yml
  ✓ Created directories
  ✓ Set permissions
  
[8/8] Next Steps
  → Configure DNS (if using domains)
  → Open firewall ports
  → Run: docker compose up -d
  → Access: https://print.example.com
```

## Docker Compose Structure

```yaml
version: '3.8'

services:
  # Always enabled
  app:
    build: .
    # ... configuration
    profiles: ["app"]  # Always active
  
  # Optional: Traefik
  traefik:
    image: traefik:v2.10
    # ... configuration
    profiles: ["traefik"]  # Enabled if user chose Traefik
  
  # Optional: Headscale
  headscale:
    image: headscale/headscale:latest
    # ... configuration
    profiles: ["headscale"]  # Enabled if user chose Headscale
  
  # Optional: Tailscale client
  tailscale:
    image: tailscale/tailscale:latest
    # ... configuration
    profiles: ["headscale"]  # Enabled with Headscale

# Profiles activated via COMPOSE_PROFILES env var
```

## Implementation Tasks

### Phase 1: Core Setup Script
- [ ] Create interactive setup.sh
- [ ] Implement configuration wizard
- [ ] Generate .env from template
- [ ] Generate docker-compose.yml with profiles
- [ ] Create required directories
- [ ] Set file permissions

### Phase 2: Docker Compose
- [ ] Create unified docker-compose.yml template
- [ ] Implement service profiles
- [ ] Configure Traefik section
- [ ] Configure Headscale section
- [ ] Test profile activation

### Phase 3: Helper Scripts
- [ ] Create configure-firewall.sh
- [ ] Create generate-authkey.sh
- [ ] Create enable-routes.sh
- [ ] Make all scripts executable

### Phase 4: Raspberry Pi Setup
- [ ] Create raspberry-pi-setup.sh
- [ ] Implement one-liner curl install
- [ ] Add interactive prompts
- [ ] Configure Tailscale client
- [ ] Set up subnet routing

### Phase 5: Documentation
- [ ] Update QUICKSTART.md
- [ ] Create DNS configuration guide
- [ ] Create firewall configuration guide
- [ ] Add troubleshooting section

### Phase 6: Testing
- [ ] Test basic deployment
- [ ] Test with Traefik
- [ ] Test with Headscale
- [ ] Test full stack
- [ ] Test Raspberry Pi setup

## Ready to Implement

All architecture and planning is complete. Ready to switch to Code mode and implement the turnkey deployment system.